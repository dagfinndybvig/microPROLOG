<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarski's World 3D - Browser Edition</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #64a0d8, #8fc0e8);
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 5px;
            font-size: 14px;
            max-width: 300px;
        }
        #info h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 5px;
            font-size: 12px;
        }
        #worldSelector {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 5px;
        }
        #worldSelector select {
            padding: 5px;
            font-size: 14px;
        }
        .object-list {
            margin-top: 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="info">
        <h2>Tarski's World 3D</h2>
        <div id="worldInfo">Loading...</div>
        <div class="object-list" id="objectList"></div>
    </div>
    
    <div id="controls">
        <strong>Controls:</strong><br>
        üñ±Ô∏è Drag: Rotate camera<br>
        üñ±Ô∏è Scroll: Zoom in/out<br>
        ‚å®Ô∏è Arrow Keys: Rotate<br>
        ‚å®Ô∏è Space: Reset view
    </div>
    
    <div id="worldSelector">
        <select id="worldSelect">
            <option value="world1">World 1 (4 objects)</option>
            <option value="world2">World 2 (7 objects)</option>
            <option value="world3">World 3 (10 objects)</option>
        </select>
    </div>

    <!-- Three.js from CDN -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Sample world data (in production, load from .pl files or JSON)
        const WORLDS = {
            world1: {
                name: "World 1",
                objects: [
                    { name: "a1", shape: "cube", size: "large", color: "red", position: [4, 8] },
                    { name: "b1", shape: "cube", size: "small", color: "yellow", position: [3, 8] },
                    { name: "c1", shape: "dodecahedron", size: "large", color: "purple", position: [5, 1] },
                    { name: "d1", shape: "dodecahedron", size: "small", color: "purple", position: [3, 7] }
                ]
            },
            world2: {
                name: "World 2",
                objects: [
                    { name: "a2", shape: "tetrahedron", size: "medium", color: "red", position: [2, 3] },
                    { name: "b2", shape: "cube", size: "large", color: "yellow", position: [5, 5] },
                    { name: "c2", shape: "dodecahedron", size: "small", color: "purple", position: [7, 2] },
                    { name: "d2", shape: "cube", size: "medium", color: "red", position: [4, 7] },
                    { name: "e2", shape: "tetrahedron", size: "small", color: "yellow", position: [6, 8] },
                    { name: "f2", shape: "dodecahedron", size: "large", color: "red", position: [2, 6] },
                    { name: "g2", shape: "cube", size: "small", color: "purple", position: [8, 4] }
                ]
            },
            world3: {
                name: "World 3",
                objects: [
                    { name: "a3", shape: "tetrahedron", size: "large", color: "red", position: [1, 1] },
                    { name: "b3", shape: "cube", size: "medium", color: "yellow", position: [3, 2] },
                    { name: "c3", shape: "dodecahedron", size: "small", color: "purple", position: [5, 3] },
                    { name: "d3", shape: "tetrahedron", size: "medium", color: "yellow", position: [7, 4] },
                    { name: "e3", shape: "cube", size: "large", color: "red", position: [2, 5] },
                    { name: "f3", shape: "dodecahedron", size: "medium", color: "purple", position: [4, 6] },
                    { name: "g3", shape: "tetrahedron", size: "small", color: "red", position: [6, 7] },
                    { name: "h3", shape: "cube", size: "small", color: "yellow", position: [8, 8] },
                    { name: "i3", shape: "dodecahedron", size: "large", color: "red", position: [1, 4] },
                    { name: "j3", shape: "cube", size: "medium", color: "purple", position: [8, 2] }
                ]
            }
        };

        // Scene setup
        let scene, camera, renderer, controls;
        let currentWorld = 'world1';
        let objects = [];

        // Color mapping
        const COLORS = {
            red: 0xdc3c3c,
            yellow: 0xf0dc3c,
            purple: 0xb450b4
        };

        // Size scaling
        const SIZES = {
            small: 0.4,
            medium: 0.6,
            large: 0.8
        };

        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x64a0d8);

            // Create camera
            camera = new THREE.PerspectiveCamera(
                45,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(10, 8, 10);
            camera.lookAt(0, 0, 0);

            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('container').appendChild(renderer.domElement);

            // Add orbit controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 5;
            controls.maxDistance = 30;

            // Add lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Create board
            createBoard();

            // Load initial world
            loadWorld(currentWorld);

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            document.getElementById('worldSelect').addEventListener('change', (e) => {
                currentWorld = e.target.value;
                loadWorld(currentWorld);
            });

            // Keyboard controls
            document.addEventListener('keydown', onKeyDown);

            // Start animation
            animate();
        }

        function createBoard() {
            const squareSize = 1;
            const boardGroup = new THREE.Group();

            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const geometry = new THREE.PlaneGeometry(squareSize, squareSize);
                    const color = (i + j) % 2 === 0 ? 0xdddddd : 0x505050;
                    const material = new THREE.MeshStandardMaterial({ 
                        color: color,
                        side: THREE.DoubleSide 
                    });
                    
                    const square = new THREE.Mesh(geometry, material);
                    
                    // Position (centered at origin, Y=0 is board level)
                    const x = -(i - 3.5) * squareSize;
                    const z = (j - 3.5) * squareSize;
                    
                    square.position.set(x, 0, z);
                    square.rotation.x = -Math.PI / 2;
                    square.receiveShadow = true;
                    
                    boardGroup.add(square);
                }
            }

            scene.add(boardGroup);
        }

        function worldTo3D(worldX, worldY) {
            // Convert world coordinates [1-8, 1-8] to 3D space
            const x = -(worldX - 4.5);
            const z = (worldY - 4.5);
            return { x, z };
        }

        function createShape(shapeType, size, color) {
            let geometry;
            const scale = SIZES[size];

            switch (shapeType) {
                case 'tetrahedron':
                    geometry = new THREE.TetrahedronGeometry(scale);
                    break;
                case 'cube':
                    geometry = new THREE.BoxGeometry(scale, scale, scale);
                    break;
                case 'dodecahedron':
                    geometry = new THREE.DodecahedronGeometry(scale);
                    break;
                default:
                    geometry = new THREE.BoxGeometry(scale, scale, scale);
            }

            const material = new THREE.MeshStandardMaterial({
                color: COLORS[color],
                metalness: 0.3,
                roughness: 0.6
            });

            const mesh = new THREE.Mesh(geometry, material);
            mesh.castShadow = true;
            mesh.receiveShadow = true;

            return mesh;
        }

        function loadWorld(worldKey) {
            // Clear existing objects
            objects.forEach(obj => scene.remove(obj));
            objects = [];

            const world = WORLDS[worldKey];
            if (!world) return;

            // Update info
            document.getElementById('worldInfo').innerHTML = 
                `<strong>${world.name}</strong><br>Objects: ${world.objects.length}`;

            // Create object list
            let listHTML = '<strong>Objects:</strong><br>';
            world.objects.forEach(obj => {
                const colorStyle = `color: ${getColorHex(obj.color)}`;
                listHTML += `<span style="${colorStyle}">‚óè ${obj.name}</span> - ${obj.shape} (${obj.size})<br>`;
            });
            document.getElementById('objectList').innerHTML = listHTML;

            // Create 3D objects
            world.objects.forEach(objData => {
                const shape = createShape(objData.shape, objData.size, objData.color);
                
                const pos = worldTo3D(objData.position[0], objData.position[1]);
                const scale = SIZES[objData.size];
                const y = scale / 2; // Lift so object sits on board
                
                shape.position.set(pos.x, y, pos.z);
                
                scene.add(shape);
                objects.push(shape);
            });
        }

        function getColorHex(colorName) {
            const colors = {
                red: '#dc3c3c',
                yellow: '#f0dc3c',
                purple: '#b450b4'
            };
            return colors[colorName] || '#808080';
        }

        function onKeyDown(event) {
            const rotateSpeed = 0.5;
            
            switch (event.key) {
                case 'ArrowLeft':
                case 'ArrowRight':
                case 'ArrowUp':
                case 'ArrowDown':
                case ' ':
                    event.preventDefault(); // Prevent default browser behavior
                    break;
            }
            
            switch (event.key) {
                case 'ArrowLeft':
                    camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), rotateSpeed);
                    break;
                case 'ArrowRight':
                    camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), -rotateSpeed);
                    break;
                case ' ':
                    camera.position.set(10, 8, 10);
                    camera.lookAt(0, 0, 0);
                    controls.reset();
                    break;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Start the application
        init();
    </script>
</body>
</html>
